{"version":3,"sources":["../src/ocean/SkyDome.ts","../src/lib/OceanSky.ts"],"names":[],"mappings":"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","file":"sky.js","sourcesContent":["import {\n  BackSide,\n  Color,\n  Mesh,\n  ShaderMaterial,\n  SphereGeometry,\n  Vector3,\n  type Camera\n} from \"three\";\n\nexport interface SkyDomeSettings {\n  skyHorizonColor: string;\n  skyZenithColor: string;\n  sunIntensity: number;\n  sunGlowPower: number;\n  sunGlowIntensity: number;\n  skyStrength: number;\n  toneMapExposure: number;\n}\n\nconst vertexShader = `\nprecision highp float;\n\nvarying vec3 vWorldPos;\n\nvoid main() {\n  vec4 worldPos = modelMatrix * vec4(position, 1.0);\n  vWorldPos = worldPos.xyz;\n  gl_Position = projectionMatrix * viewMatrix * worldPos;\n}\n`;\n\nconst fragmentShader = `\nprecision highp float;\n\nuniform vec3 uSkyHorizonColor;\nuniform vec3 uSkyZenithColor;\nuniform vec3 uSunDirection;\nuniform float uSunIntensity;\nuniform float uSunGlowPower;\nuniform float uSunGlowIntensity;\nuniform float uSkyStrength;\nuniform float uToneMapExposure;\n\nvarying vec3 vWorldPos;\n\nvec3 extraCheapAtmosphere(vec3 raydir, vec3 sundir) {\n  sundir.y = max(sundir.y, -0.07);\n  float specialA = 1.0 / (raydir.y * 1.0 + 0.1);\n  float specialB = 1.0 / (sundir.y * 11.0 + 1.0);\n  float raySunDt = pow(abs(dot(sundir, raydir)), 2.0);\n  float sunDt = pow(max(0.0, dot(sundir, raydir)), 8.0);\n  float mie = sunDt * specialA * 0.2;\n  vec3 sunColor = mix(\n    vec3(1.0),\n    max(vec3(0.0), vec3(1.0) - vec3(5.5, 13.0, 22.4) / 22.4),\n    specialB\n  );\n  vec3 blueSky = vec3(5.5, 13.0, 22.4) / 22.4 * sunColor;\n  vec3 blueSky2 = max(\n    vec3(0.0),\n    blueSky - vec3(5.5, 13.0, 22.4) * 0.002 * (specialA + -6.0 * sundir.y * sundir.y)\n  );\n  blueSky2 *= specialA * (0.24 + raySunDt * 0.24);\n  return blueSky2 * (1.0 + pow(1.0 - raydir.y, 3.0)) + mie * sunColor;\n}\n\nfloat getSun(vec3 dir) {\n  return pow(max(0.0, dot(dir, normalize(uSunDirection))), uSunGlowPower) * uSunGlowIntensity;\n}\n\nvec3 acesTonemap(vec3 color) {\n  mat3 m1 = mat3(\n    0.59719, 0.07600, 0.02840,\n    0.35458, 0.90834, 0.13383,\n    0.04823, 0.01566, 0.83777\n  );\n  mat3 m2 = mat3(\n    1.60475, -0.10208, -0.00327,\n    -0.53108, 1.10813, -0.07276,\n    -0.07367, -0.00605, 1.07602\n  );\n  vec3 v = m1 * color;\n  vec3 a = v * (v + 0.0245786) - 0.000090537;\n  vec3 b = v * (0.983729 * v + 0.4329510) + 0.238081;\n  return pow(clamp(m2 * (a / b), 0.0, 1.0), vec3(1.0 / 2.2));\n}\n\nvoid main() {\n  vec3 dir = normalize(vWorldPos - cameraPosition);\n  float horizon = clamp(dir.y * 0.5 + 0.5, 0.0, 1.0);\n  vec3 gradient = mix(uSkyHorizonColor, uSkyZenithColor, pow(horizon, 0.72));\n  vec3 atmosphere = extraCheapAtmosphere(dir, normalize(uSunDirection)) * uSkyStrength;\n  vec3 sun = vec3(getSun(dir) * uSunIntensity);\n  vec3 color = gradient + atmosphere + sun;\n  gl_FragColor = vec4(acesTonemap(color * uToneMapExposure), 1.0);\n}\n`;\n\nexport class SkyDome {\n  public readonly mesh: Mesh<SphereGeometry, ShaderMaterial>;\n  private readonly horizonColor = new Color();\n  private readonly zenithColor = new Color();\n\n  constructor() {\n    const geometry = new SphereGeometry(7600, 64, 32);\n    const material = new ShaderMaterial({\n      name: \"OceanSkyDome\",\n      side: BackSide,\n      depthWrite: false,\n      uniforms: {\n        uSkyHorizonColor: { value: new Color(\"#9dc7ea\") },\n        uSkyZenithColor: { value: new Color(\"#2e5e96\") },\n        uSunDirection: { value: new Vector3(0.6, 0.8, 0.2) },\n        uSunIntensity: { value: 1.2 },\n        uSunGlowPower: { value: 660.0 },\n        uSunGlowIntensity: { value: 210.0 },\n        uSkyStrength: { value: 0.7 },\n        uToneMapExposure: { value: 2.1 }\n      },\n      vertexShader,\n      fragmentShader\n    });\n    this.mesh = new Mesh(geometry, material);\n    this.mesh.name = \"OceanSkyDome\";\n    this.mesh.frustumCulled = false;\n  }\n\n  update(settings: SkyDomeSettings, sunDirection: Vector3, camera: Camera): void {\n    this.mesh.position.copy(camera.position);\n    this.horizonColor.set(settings.skyHorizonColor);\n    this.zenithColor.set(settings.skyZenithColor);\n    const { uniforms } = this.mesh.material;\n    uniforms.uSkyHorizonColor.value.copy(this.horizonColor);\n    uniforms.uSkyZenithColor.value.copy(this.zenithColor);\n    uniforms.uSunDirection.value.copy(sunDirection);\n    uniforms.uSunIntensity.value = settings.sunIntensity;\n    uniforms.uSunGlowPower.value = settings.sunGlowPower;\n    uniforms.uSunGlowIntensity.value = settings.sunGlowIntensity;\n    uniforms.uSkyStrength.value = settings.skyStrength;\n    uniforms.uToneMapExposure.value = settings.toneMapExposure;\n  }\n\n  dispose(): void {\n    this.mesh.geometry.dispose();\n    this.mesh.material.dispose();\n  }\n}\n","import type { Camera, Vector3 } from \"three\";\nimport { SkyDome, type SkyDomeSettings } from \"../ocean/SkyDome\";\n\nexport type OceanSkyOptions = SkyDomeSettings;\n\nconst DEFAULT_OCEAN_SKY_OPTIONS: OceanSkyOptions = {\n  skyHorizonColor: \"#9dc7ea\",\n  skyZenithColor: \"#2e5e96\",\n  sunIntensity: 1.2,\n  sunGlowPower: 660.0,\n  sunGlowIntensity: 210.0,\n  skyStrength: 0.7,\n  toneMapExposure: 2.1\n};\n\nfunction buildDefaultOceanSkyOptions(): OceanSkyOptions {\n  return { ...DEFAULT_OCEAN_SKY_OPTIONS };\n}\n\nexport class OceanSky {\n  public readonly object3d;\n  private readonly dome: SkyDome;\n  private readonly options: OceanSkyOptions;\n\n  constructor(options?: Partial<OceanSkyOptions>) {\n    this.options = {\n      ...buildDefaultOceanSkyOptions(),\n      ...(options ?? {})\n    };\n    this.dome = new SkyDome();\n    this.object3d = this.dome.mesh;\n  }\n\n  getOptions(): OceanSkyOptions {\n    return { ...this.options };\n  }\n\n  setOptions(options: Partial<OceanSkyOptions>): void {\n    Object.assign(this.options, options);\n  }\n\n  update(camera: Camera, sunDirection: Vector3): void {\n    this.dome.update(this.options, sunDirection, camera);\n  }\n\n  dispose(): void {\n    this.dome.dispose();\n  }\n}\n\nexport function createOceanSky(options?: Partial<OceanSkyOptions>): OceanSky {\n  return new OceanSky(options);\n}\n\nexport function createDefaultOceanSkyOptions(): OceanSkyOptions {\n  return buildDefaultOceanSkyOptions();\n}\n"]}
{"version":3,"sources":["../src/ocean/oceanGeometry.ts","../src/ocean/oceanShader.ts","../src/ocean/types.ts","../src/ocean/waveMath.ts","../src/ocean/OceanSystem.ts","../src/lib/Ocean.ts"],"names":["BufferGeometry","BufferAttribute","ShaderMaterial","Color","Vector3","Group","Mesh","MathUtils","LineBasicMaterial","LineLoop"],"mappings":"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AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,CAAA;AA0GrB,IAAM,cAAA,GAAiB;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;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","file":"index.cjs","sourcesContent":["import { BufferAttribute, BufferGeometry } from \"three\";\nimport type { OceanSettings, RingSpec } from \"./types\";\n\nexport function buildRingSpecs(settings: OceanSettings): RingSpec[] {\n  const rings: RingSpec[] = [];\n  const ringCount = Math.max(1, Math.floor(settings.ringCount));\n  const angularSegments = Math.max(16, Math.floor(settings.angularSegments));\n  let innerRadius = 0.0;\n  let ringWidth = Math.max(4.0, settings.baseRingWidth);\n\n  for (let ringIndex = 0; ringIndex < ringCount; ringIndex += 1) {\n    const outerRadius = innerRadius + ringWidth;\n    const rawRadialSegments = Math.round(\n      settings.centerRadialSegments * Math.pow(settings.radialSegmentsDecay, ringIndex)\n    );\n    const radialSegments = Math.max(settings.minRadialSegments, rawRadialSegments);\n    const detailScale = Math.max(0.12, Math.pow(settings.detailFalloff, ringIndex));\n\n    rings.push({\n      index: ringIndex,\n      innerRadius,\n      outerRadius,\n      radialSegments,\n      angularSegments,\n      detailScale\n    });\n\n    innerRadius = outerRadius;\n    ringWidth *= settings.ringWidthGrowth;\n  }\n\n  return rings;\n}\n\nexport function createRingGeometry(spec: RingSpec): BufferGeometry {\n  const radialVertices = spec.radialSegments + 1;\n  const angularVertices = spec.angularSegments + 1;\n  const totalVertices = radialVertices * angularVertices;\n  const positionArray = new Float32Array(totalVertices * 3);\n  const uvArray = new Float32Array(totalVertices * 2);\n  const localRadiusArray = new Float32Array(totalVertices);\n  const indices: number[] = [];\n\n  let vertexOffset = 0;\n  let uvOffset = 0;\n  let radiusOffset = 0;\n\n  for (let radial = 0; radial <= spec.radialSegments; radial += 1) {\n    const radialT = radial / spec.radialSegments;\n    const radius = spec.innerRadius + (spec.outerRadius - spec.innerRadius) * radialT;\n\n    for (let angular = 0; angular <= spec.angularSegments; angular += 1) {\n      const angularT = angular / spec.angularSegments;\n      const angle = angularT * Math.PI * 2.0;\n      const x = Math.cos(angle) * radius;\n      const z = Math.sin(angle) * radius;\n\n      positionArray[vertexOffset] = x;\n      positionArray[vertexOffset + 1] = 0.0;\n      positionArray[vertexOffset + 2] = z;\n      vertexOffset += 3;\n\n      uvArray[uvOffset] = 0.5 + x / (spec.outerRadius * 2.0);\n      uvArray[uvOffset + 1] = 0.5 + z / (spec.outerRadius * 2.0);\n      uvOffset += 2;\n\n      localRadiusArray[radiusOffset] = radius;\n      radiusOffset += 1;\n    }\n  }\n\n  for (let radial = 0; radial < spec.radialSegments; radial += 1) {\n    for (let angular = 0; angular < spec.angularSegments; angular += 1) {\n      const row = radial * angularVertices;\n      const nextRow = (radial + 1) * angularVertices;\n      const a = row + angular;\n      const b = nextRow + angular;\n      const c = nextRow + angular + 1;\n      const d = row + angular + 1;\n      // Winding is set so front faces point upward (+Y), making water visible from above.\n      indices.push(a, c, b, a, d, c);\n    }\n  }\n\n  const indexArray =\n    totalVertices > 65535 ? new Uint32Array(indices) : new Uint16Array(indices);\n\n  const geometry = new BufferGeometry();\n  geometry.setAttribute(\"position\", new BufferAttribute(positionArray, 3));\n  geometry.setAttribute(\"uv\", new BufferAttribute(uvArray, 2));\n  geometry.setAttribute(\"aLocalRadius\", new BufferAttribute(localRadiusArray, 1));\n  geometry.setIndex(new BufferAttribute(indexArray, 1));\n  geometry.computeBoundingSphere();\n\n  return geometry;\n}\n","import { Color, ShaderMaterial, Vector3 } from \"three\";\n\nconst vertexShader = `\nprecision highp float;\n\nattribute float aLocalRadius;\n\nuniform float uTime;\nuniform float uSeaLevel;\nuniform float uWaveAmplitude;\nuniform float uWaveMean;\nuniform float uDragMultiplier;\nuniform float uBaseFrequency;\nuniform float uFrequencyMultiplier;\nuniform float uBaseTimeMultiplier;\nuniform float uTimeMultiplierGrowth;\nuniform float uWeightDecay;\nuniform float uWaveDirectionSeed;\nuniform float uPhaseOffset;\nuniform float uDisplacementOctaves;\nuniform float uRingDetailScale;\nuniform float uHighFrequencyFadeDistance;\nuniform float uHighFrequencyFadeStrength;\n\nvarying vec3 vWorldPos;\nvarying float vRawWave;\nvarying float vLocalRadius;\nvarying float vDetailScale;\n\n#define MAX_OCTAVES 48\n\nvec2 wavedx(vec2 position, vec2 direction, float frequency, float timeshift) {\n  float x = dot(direction, position) * frequency + timeshift;\n  float wave = exp(sin(x) - 1.0);\n  float dx = wave * cos(x);\n  return vec2(wave, -dx);\n}\n\nfloat getDistanceDetailFade(float octaveT, float distanceFromCamera) {\n  if (uHighFrequencyFadeStrength <= 0.0001) {\n    return 1.0;\n  }\n\n  float distFade = smoothstep(\n    uHighFrequencyFadeDistance,\n    uHighFrequencyFadeDistance * 2.5,\n    distanceFromCamera\n  );\n  return clamp(1.0 - distFade * octaveT * uHighFrequencyFadeStrength, 0.0, 1.0);\n}\n\nfloat getWaves(vec2 position, float distanceFromCamera, float octaveCountFloat) {\n  int octaveCount = int(clamp(floor(octaveCountFloat + 0.5), 0.0, float(MAX_OCTAVES)));\n  if (octaveCount <= 0) {\n    return uWaveMean;\n  }\n  float iter = 0.0;\n  float frequency = uBaseFrequency;\n  float timeMultiplier = uBaseTimeMultiplier;\n  float weight = 1.0;\n  float sumOfValues = 0.0;\n  float sumOfWeights = 0.0;\n\n  for (int i = 0; i < MAX_OCTAVES; i++) {\n    if (i >= octaveCount) {\n      break;\n    }\n\n    vec2 direction = vec2(sin(iter + uWaveDirectionSeed), cos(iter + uWaveDirectionSeed));\n    vec2 waveData = wavedx(\n      position,\n      direction,\n      frequency,\n      uTime * timeMultiplier + uPhaseOffset\n    );\n\n    float octaveT = float(i) / max(float(octaveCount - 1), 1.0);\n    float detailFade = getDistanceDetailFade(octaveT, distanceFromCamera);\n    float octaveWeight = weight * detailFade;\n\n    position += direction * waveData.y * octaveWeight * uDragMultiplier;\n    sumOfValues += waveData.x * octaveWeight;\n    sumOfWeights += octaveWeight;\n\n    weight *= uWeightDecay;\n    frequency *= uFrequencyMultiplier;\n    timeMultiplier *= uTimeMultiplierGrowth;\n    iter += 1232.399963;\n  }\n\n  return sumOfValues / max(sumOfWeights, 0.0001);\n}\n\nvoid main() {\n  vec4 worldBase = modelMatrix * vec4(position, 1.0);\n  float distanceFromCamera = distance(worldBase.xz, cameraPosition.xz);\n  float rawWave = getWaves(worldBase.xz, distanceFromCamera, uDisplacementOctaves);\n  worldBase.y = uSeaLevel + (rawWave - uWaveMean) * uWaveAmplitude;\n\n  vWorldPos = worldBase.xyz;\n  vRawWave = rawWave;\n  vLocalRadius = aLocalRadius;\n  vDetailScale = uRingDetailScale;\n\n  gl_Position = projectionMatrix * viewMatrix * worldBase;\n}\n`;\n\nconst fragmentShader = `\nprecision highp float;\n\nuniform float uTime;\nuniform float uSeaLevel;\nuniform float uWaveAmplitude;\nuniform float uWaveMean;\nuniform float uDragMultiplier;\nuniform float uBaseFrequency;\nuniform float uFrequencyMultiplier;\nuniform float uBaseTimeMultiplier;\nuniform float uTimeMultiplierGrowth;\nuniform float uWeightDecay;\nuniform float uWaveDirectionSeed;\nuniform float uPhaseOffset;\nuniform float uDisplacementOctaves;\nuniform float uNormalOctaves;\nuniform float uNormalEpsilon;\nuniform float uHighFrequencyFadeDistance;\nuniform float uHighFrequencyFadeStrength;\nuniform float uFresnelBase;\nuniform float uFresnelPower;\nuniform float uReflectionStrength;\nuniform float uScatterStrength;\nuniform float uSkyStrength;\nuniform float uToneMapExposure;\nuniform vec3 uShallowColor;\nuniform vec3 uDeepColor;\nuniform vec3 uFoamColor;\nuniform float uFoamEnabled;\nuniform float uFoamThreshold;\nuniform float uFoamIntensity;\nuniform vec3 uSkyHorizonColor;\nuniform vec3 uSkyZenithColor;\nuniform vec3 uSunDirection;\nuniform float uSunIntensity;\nuniform float uSunGlowPower;\nuniform float uSunGlowIntensity;\nuniform float uFarFadeStart;\nuniform float uFarFadeEnd;\nuniform float uRingDetailScale;\nuniform int uDebugMode;\n\nvarying vec3 vWorldPos;\nvarying float vRawWave;\nvarying float vLocalRadius;\nvarying float vDetailScale;\n\n#define MAX_OCTAVES 48\n\nvec2 wavedx(vec2 position, vec2 direction, float frequency, float timeshift) {\n  float x = dot(direction, position) * frequency + timeshift;\n  float wave = exp(sin(x) - 1.0);\n  float dx = wave * cos(x);\n  return vec2(wave, -dx);\n}\n\nfloat getDistanceDetailFade(float octaveT, float distanceFromCamera) {\n  if (uHighFrequencyFadeStrength <= 0.0001) {\n    return 1.0;\n  }\n\n  float distFade = smoothstep(\n    uHighFrequencyFadeDistance,\n    uHighFrequencyFadeDistance * 2.5,\n    distanceFromCamera\n  );\n  return clamp(1.0 - distFade * octaveT * uHighFrequencyFadeStrength, 0.0, 1.0);\n}\n\nfloat getWaves(vec2 position, float distanceFromCamera, float octaveCountFloat) {\n  int octaveCount = int(clamp(floor(octaveCountFloat + 0.5), 0.0, float(MAX_OCTAVES)));\n  if (octaveCount <= 0) {\n    return uWaveMean;\n  }\n  float iter = 0.0;\n  float frequency = uBaseFrequency;\n  float timeMultiplier = uBaseTimeMultiplier;\n  float weight = 1.0;\n  float sumOfValues = 0.0;\n  float sumOfWeights = 0.0;\n\n  for (int i = 0; i < MAX_OCTAVES; i++) {\n    if (i >= octaveCount) {\n      break;\n    }\n\n    vec2 direction = vec2(sin(iter + uWaveDirectionSeed), cos(iter + uWaveDirectionSeed));\n    vec2 waveData = wavedx(\n      position,\n      direction,\n      frequency,\n      uTime * timeMultiplier + uPhaseOffset\n    );\n\n    float octaveT = float(i) / max(float(octaveCount - 1), 1.0);\n    float detailFade = getDistanceDetailFade(octaveT, distanceFromCamera);\n    float octaveWeight = weight * detailFade;\n\n    position += direction * waveData.y * octaveWeight * uDragMultiplier;\n    sumOfValues += waveData.x * octaveWeight;\n    sumOfWeights += octaveWeight;\n\n    weight *= uWeightDecay;\n    frequency *= uFrequencyMultiplier;\n    timeMultiplier *= uTimeMultiplierGrowth;\n    iter += 1232.399963;\n  }\n\n  return sumOfValues / max(sumOfWeights, 0.0001);\n}\n\nfloat sampleHeight(vec2 worldXZ, float octaveCountFloat) {\n  float distanceFromCamera = distance(worldXZ, cameraPosition.xz);\n  float wave = getWaves(worldXZ, distanceFromCamera, octaveCountFloat);\n  return uSeaLevel + (wave - uWaveMean) * uWaveAmplitude;\n}\n\nvec3 extraCheapAtmosphere(vec3 raydir, vec3 sundir) {\n  sundir.y = max(sundir.y, -0.07);\n  float specialA = 1.0 / (raydir.y * 1.0 + 0.1);\n  float specialB = 1.0 / (sundir.y * 11.0 + 1.0);\n  float raySunDt = pow(abs(dot(sundir, raydir)), 2.0);\n  float sunDt = pow(max(0.0, dot(sundir, raydir)), 8.0);\n  float mie = sunDt * specialA * 0.2;\n  vec3 sunColor = mix(\n    vec3(1.0),\n    max(vec3(0.0), vec3(1.0) - vec3(5.5, 13.0, 22.4) / 22.4),\n    specialB\n  );\n  vec3 blueSky = vec3(5.5, 13.0, 22.4) / 22.4 * sunColor;\n  vec3 blueSky2 = max(\n    vec3(0.0),\n    blueSky - vec3(5.5, 13.0, 22.4) * 0.002 * (specialA + -6.0 * sundir.y * sundir.y)\n  );\n  blueSky2 *= specialA * (0.24 + raySunDt * 0.24);\n  return blueSky2 * (1.0 + pow(1.0 - raydir.y, 3.0)) + mie * sunColor;\n}\n\nfloat getSun(vec3 dir) {\n  return pow(max(0.0, dot(dir, normalize(uSunDirection))), uSunGlowPower) * uSunGlowIntensity;\n}\n\nvec3 getSky(vec3 dir) {\n  vec3 ndir = normalize(dir);\n  float horizon = clamp(ndir.y * 0.5 + 0.5, 0.0, 1.0);\n  vec3 gradient = mix(uSkyHorizonColor, uSkyZenithColor, pow(horizon, 0.65));\n  vec3 atmosphere = extraCheapAtmosphere(ndir, normalize(uSunDirection)) * uSkyStrength;\n  vec3 sun = vec3(getSun(ndir) * uSunIntensity);\n  return gradient + atmosphere + sun;\n}\n\nvec3 acesTonemap(vec3 color) {\n  mat3 m1 = mat3(\n    0.59719, 0.07600, 0.02840,\n    0.35458, 0.90834, 0.13383,\n    0.04823, 0.01566, 0.83777\n  );\n  mat3 m2 = mat3(\n    1.60475, -0.10208, -0.00327,\n    -0.53108, 1.10813, -0.07276,\n    -0.07367, -0.00605, 1.07602\n  );\n  vec3 v = m1 * color;\n  vec3 a = v * (v + 0.0245786) - 0.000090537;\n  vec3 b = v * (0.983729 * v + 0.4329510) + 0.238081;\n  return pow(clamp(m2 * (a / b), 0.0, 1.0), vec3(1.0 / 2.2));\n}\n\nvoid main() {\n  vec3 viewDir = normalize(cameraPosition - vWorldPos);\n  vec3 viewRay = normalize(vWorldPos - cameraPosition);\n\n  vec3 N = vec3(0.0, 1.0, 0.0);\n  if (uNormalOctaves > 0.0) {\n    float normalOctaves = max(1.0, uNormalOctaves);\n    float h = sampleHeight(vWorldPos.xz, normalOctaves);\n    float hx = sampleHeight(vWorldPos.xz + vec2(uNormalEpsilon, 0.0), normalOctaves);\n    float hz = sampleHeight(vWorldPos.xz + vec2(0.0, uNormalEpsilon), normalOctaves);\n    vec3 dx = vec3(uNormalEpsilon, hx - h, 0.0);\n    vec3 dz = vec3(0.0, hz - h, uNormalEpsilon);\n    N = normalize(cross(dz, dx));\n    if (N.y < 0.0) {\n      N = -N;\n    }\n  }\n\n  float cosTheta = max(0.0, dot(N, viewDir));\n  float fresnel = uFresnelBase + (1.0 - uFresnelBase) * pow(1.0 - cosTheta, uFresnelPower);\n\n  vec3 reflectionRay = reflect(-viewDir, N);\n  reflectionRay.y = abs(reflectionRay.y);\n  vec3 reflection = getSky(reflectionRay) * uReflectionStrength;\n\n  float depthFactor = clamp((uSeaLevel - vWorldPos.y) / max(uWaveAmplitude, 0.001) * 0.5 + 0.5, 0.0, 1.0);\n  vec3 scattering = mix(uShallowColor, uDeepColor, depthFactor) * uScatterStrength;\n\n  float slope = 1.0 - clamp(N.y, 0.0, 1.0);\n  float crest = smoothstep(uWaveMean + 0.1, uWaveMean + 0.45, vRawWave);\n  float foam = smoothstep(uFoamThreshold, 1.0, slope) * crest * uFoamIntensity * uFoamEnabled;\n\n  vec3 color = mix(scattering, reflection, fresnel);\n  color = mix(color, uFoamColor, clamp(foam, 0.0, 1.0));\n\n  float distanceFromCamera = distance(vWorldPos.xz, cameraPosition.xz);\n  float farFade = smoothstep(uFarFadeStart, uFarFadeEnd, distanceFromCamera);\n  vec3 skyAlongRay = getSky(-viewRay);\n  vec3 shadedColor = mix(color, skyAlongRay, farFade);\n\n  if (uDebugMode == 1) {\n    shadedColor = N * 0.5 + 0.5;\n  } else if (uDebugMode == 2) {\n    float waveHeightN = clamp((vWorldPos.y - uSeaLevel) / max(uWaveAmplitude * 2.0, 0.001) + 0.5, 0.0, 1.0);\n    shadedColor = vec3(\n      smoothstep(0.4, 1.0, waveHeightN),\n      1.0 - abs(waveHeightN - 0.5) * 1.5,\n      smoothstep(0.0, 0.6, 1.0 - waveHeightN)\n    );\n  } else if (uDebugMode == 3) {\n    shadedColor = vec3(fresnel);\n  } else if (uDebugMode == 4) {\n    shadedColor = vec3(vDetailScale, 0.2, 1.0 - vDetailScale);\n  }\n\n  gl_FragColor = vec4(acesTonemap(shadedColor * uToneMapExposure), 1.0);\n}\n`;\n\nexport function createOceanMaterial(ringDetailScale: number): ShaderMaterial {\n  return new ShaderMaterial({\n    name: \"OceanRingMaterial\",\n    uniforms: {\n      uTime: { value: 0.0 },\n      uSeaLevel: { value: 0.0 },\n      uWaveAmplitude: { value: 1.0 },\n      uWaveMean: { value: 0.56 },\n      uDragMultiplier: { value: 0.28 },\n      uBaseFrequency: { value: 1.0 },\n      uFrequencyMultiplier: { value: 1.18 },\n      uBaseTimeMultiplier: { value: 2.0 },\n      uTimeMultiplierGrowth: { value: 1.07 },\n      uWeightDecay: { value: 0.82 },\n      uWaveDirectionSeed: { value: 0.0 },\n      uPhaseOffset: { value: 0.0 },\n      uDisplacementOctaves: { value: 10.0 },\n      uNormalOctaves: { value: 32.0 },\n      uNormalEpsilon: { value: 0.08 },\n      uHighFrequencyFadeDistance: { value: 350.0 },\n      uHighFrequencyFadeStrength: { value: 0.9 },\n      uFresnelBase: { value: 0.04 },\n      uFresnelPower: { value: 5.0 },\n      uReflectionStrength: { value: 1.0 },\n      uScatterStrength: { value: 1.0 },\n      uSkyStrength: { value: 0.7 },\n      uToneMapExposure: { value: 2.1 },\n      uShallowColor: { value: new Color(\"#3b8ac5\") },\n      uDeepColor: { value: new Color(\"#093a7a\") },\n      uFoamColor: { value: new Color(\"#dff7ff\") },\n      uFoamEnabled: { value: 1.0 },\n      uFoamThreshold: { value: 0.12 },\n      uFoamIntensity: { value: 0.55 },\n      uSkyHorizonColor: { value: new Color(\"#9dc7ea\") },\n      uSkyZenithColor: { value: new Color(\"#2e5e96\") },\n      uSunDirection: { value: new Vector3(0.6, 0.8, 0.2) },\n      uSunIntensity: { value: 1.2 },\n      uSunGlowPower: { value: 660.0 },\n      uSunGlowIntensity: { value: 210.0 },\n      uFarFadeStart: { value: 460.0 },\n      uFarFadeEnd: { value: 1050.0 },\n      uRingDetailScale: { value: ringDetailScale },\n      uDebugMode: { value: 0 }\n    },\n    vertexShader,\n    fragmentShader\n  });\n}\n","export type DebugViewMode = \"none\" | \"normals\" | \"height\" | \"fresnel\" | \"rings\";\n\n// Render/behavior settings only. Simulation clock policy lives at the app layer.\nexport interface OceanSettings {\n  seaLevel: number;\n  waveAmplitude: number;\n  waveMean: number;\n  dragMultiplier: number;\n  baseFrequency: number;\n  frequencyMultiplier: number;\n  baseTimeMultiplier: number;\n  timeMultiplierGrowth: number;\n  weightDecay: number;\n  waveDirectionSeed: number;\n  phaseOffset: number;\n  displacementOctaves: number;\n  normalOctaves: number;\n  normalEpsilon: number;\n  highFrequencyFadeDistance: number;\n  highFrequencyFadeStrength: number;\n  fresnelBase: number;\n  fresnelPower: number;\n  reflectionStrength: number;\n  scatterStrength: number;\n  skyStrength: number;\n  toneMapExposure: number;\n  shallowColor: string;\n  deepColor: string;\n  foamEnabled: boolean;\n  foamThreshold: number;\n  foamIntensity: number;\n  foamColor: string;\n  skyHorizonColor: string;\n  skyZenithColor: string;\n  sunIntensity: number;\n  sunGlowPower: number;\n  sunGlowIntensity: number;\n  sunElevationDeg: number;\n  sunAzimuthDeg: number;\n  animateSun: boolean;\n  sunOrbitSpeed: number;\n  ringCount: number;\n  baseRingWidth: number;\n  ringWidthGrowth: number;\n  centerRadialSegments: number;\n  radialSegmentsDecay: number;\n  minRadialSegments: number;\n  angularSegments: number;\n  detailFalloff: number;\n  followSnap: number;\n  followCameraEveryFrame: boolean;\n  farFadeStart: number;\n  farFadeEnd: number;\n  wireframe: boolean;\n  debugView: DebugViewMode;\n}\n\nexport type OceanWaveSettings = Pick<\n  OceanSettings,\n  | \"seaLevel\"\n  | \"waveAmplitude\"\n  | \"waveMean\"\n  | \"dragMultiplier\"\n  | \"baseFrequency\"\n  | \"frequencyMultiplier\"\n  | \"baseTimeMultiplier\"\n  | \"timeMultiplierGrowth\"\n  | \"weightDecay\"\n  | \"waveDirectionSeed\"\n  | \"phaseOffset\"\n  | \"displacementOctaves\"\n  | \"normalOctaves\"\n  | \"normalEpsilon\"\n  | \"highFrequencyFadeDistance\"\n  | \"highFrequencyFadeStrength\"\n>;\n\nexport type OceanShadingSettings = Pick<\n  OceanSettings,\n  | \"fresnelBase\"\n  | \"fresnelPower\"\n  | \"reflectionStrength\"\n  | \"scatterStrength\"\n  | \"skyStrength\"\n  | \"toneMapExposure\"\n  | \"shallowColor\"\n  | \"deepColor\"\n  | \"foamEnabled\"\n  | \"foamThreshold\"\n  | \"foamIntensity\"\n  | \"foamColor\"\n  | \"skyHorizonColor\"\n  | \"skyZenithColor\"\n  | \"farFadeStart\"\n  | \"farFadeEnd\"\n>;\n\nexport type OceanSunSettings = Pick<\n  OceanSettings,\n  | \"sunIntensity\"\n  | \"sunGlowPower\"\n  | \"sunGlowIntensity\"\n  | \"sunElevationDeg\"\n  | \"sunAzimuthDeg\"\n  | \"animateSun\"\n  | \"sunOrbitSpeed\"\n>;\n\nexport type OceanGeometrySettings = Pick<\n  OceanSettings,\n  | \"ringCount\"\n  | \"baseRingWidth\"\n  | \"ringWidthGrowth\"\n  | \"centerRadialSegments\"\n  | \"radialSegmentsDecay\"\n  | \"minRadialSegments\"\n  | \"angularSegments\"\n  | \"detailFalloff\"\n  | \"followSnap\"\n  | \"followCameraEveryFrame\"\n>;\n\nexport type OceanDebugSettings = Pick<OceanSettings, \"wireframe\" | \"debugView\">;\n\nexport const OCEAN_WAVE_KEYS = [\n  \"seaLevel\",\n  \"waveAmplitude\",\n  \"waveMean\",\n  \"dragMultiplier\",\n  \"baseFrequency\",\n  \"frequencyMultiplier\",\n  \"baseTimeMultiplier\",\n  \"timeMultiplierGrowth\",\n  \"weightDecay\",\n  \"waveDirectionSeed\",\n  \"phaseOffset\",\n  \"displacementOctaves\",\n  \"normalOctaves\",\n  \"normalEpsilon\",\n  \"highFrequencyFadeDistance\",\n  \"highFrequencyFadeStrength\"\n] as const satisfies ReadonlyArray<keyof OceanSettings>;\n\nexport const OCEAN_SHADING_KEYS = [\n  \"fresnelBase\",\n  \"fresnelPower\",\n  \"reflectionStrength\",\n  \"scatterStrength\",\n  \"skyStrength\",\n  \"toneMapExposure\",\n  \"shallowColor\",\n  \"deepColor\",\n  \"foamEnabled\",\n  \"foamThreshold\",\n  \"foamIntensity\",\n  \"foamColor\",\n  \"skyHorizonColor\",\n  \"skyZenithColor\",\n  \"farFadeStart\",\n  \"farFadeEnd\"\n] as const satisfies ReadonlyArray<keyof OceanSettings>;\n\nexport const OCEAN_SUN_KEYS = [\n  \"sunIntensity\",\n  \"sunGlowPower\",\n  \"sunGlowIntensity\",\n  \"sunElevationDeg\",\n  \"sunAzimuthDeg\",\n  \"animateSun\",\n  \"sunOrbitSpeed\"\n] as const satisfies ReadonlyArray<keyof OceanSettings>;\n\nexport const OCEAN_GEOMETRY_KEYS = [\n  \"ringCount\",\n  \"baseRingWidth\",\n  \"ringWidthGrowth\",\n  \"centerRadialSegments\",\n  \"radialSegmentsDecay\",\n  \"minRadialSegments\",\n  \"angularSegments\",\n  \"detailFalloff\"\n] as const satisfies ReadonlyArray<keyof OceanSettings>;\n\nexport const OCEAN_DEBUG_KEYS = [\"wireframe\", \"debugView\"] as const satisfies ReadonlyArray<\n  keyof OceanSettings\n>;\n\nexport interface WaveSamplingParams {\n  seaLevel: number;\n  waveAmplitude: number;\n  waveMean: number;\n  dragMultiplier: number;\n  baseFrequency: number;\n  frequencyMultiplier: number;\n  baseTimeMultiplier: number;\n  timeMultiplierGrowth: number;\n  weightDecay: number;\n  waveDirectionSeed: number;\n  phaseOffset: number;\n  displacementOctaves: number;\n}\n\nexport interface RingSpec {\n  index: number;\n  innerRadius: number;\n  outerRadius: number;\n  radialSegments: number;\n  angularSegments: number;\n  detailScale: number;\n}\n\nexport const DEFAULT_OCEAN_SETTINGS: OceanSettings = {\n  seaLevel: 0,\n  waveAmplitude: 1.28,\n  waveMean: 0.56,\n  dragMultiplier: 0.28,\n  baseFrequency: 1.0,\n  frequencyMultiplier: 1.18,\n  baseTimeMultiplier: 2.0,\n  timeMultiplierGrowth: 1.07,\n  weightDecay: 0.82,\n  waveDirectionSeed: 0.0,\n  phaseOffset: 0.0,\n  displacementOctaves: 10,\n  normalOctaves: 24,\n  normalEpsilon: 0.08,\n  highFrequencyFadeDistance: 350.0,\n  highFrequencyFadeStrength: 0.92,\n  fresnelBase: 0.04,\n  fresnelPower: 5.0,\n  reflectionStrength: 1.0,\n  scatterStrength: 1.0,\n  skyStrength: 0.7,\n  toneMapExposure: 2.1,\n  shallowColor: \"#3b8ac5\",\n  deepColor: \"#093a7a\",\n  foamEnabled: true,\n  foamThreshold: 0.12,\n  foamIntensity: 0.55,\n  foamColor: \"#dff7ff\",\n  skyHorizonColor: \"#9dc7ea\",\n  skyZenithColor: \"#2e5e96\",\n  sunIntensity: 1.2,\n  sunGlowPower: 660.0,\n  sunGlowIntensity: 210.0,\n  sunElevationDeg: 34.0,\n  sunAzimuthDeg: 20.0,\n  animateSun: false,\n  sunOrbitSpeed: 0.1,\n  ringCount: 6,\n  baseRingWidth: 42.0,\n  ringWidthGrowth: 1.66,\n  centerRadialSegments: 24,\n  radialSegmentsDecay: 0.8,\n  minRadialSegments: 4,\n  angularSegments: 256,\n  detailFalloff: 0.82,\n  followSnap: 1.0,\n  followCameraEveryFrame: false,\n  farFadeStart: 460.0,\n  farFadeEnd: 1050.0,\n  wireframe: false,\n  debugView: \"none\"\n};\n\nexport function toWaveSamplingParams(settings: OceanSettings): WaveSamplingParams {\n  return {\n    seaLevel: settings.seaLevel,\n    waveAmplitude: settings.waveAmplitude,\n    waveMean: settings.waveMean,\n    dragMultiplier: settings.dragMultiplier,\n    baseFrequency: settings.baseFrequency,\n    frequencyMultiplier: settings.frequencyMultiplier,\n    baseTimeMultiplier: settings.baseTimeMultiplier,\n    timeMultiplierGrowth: settings.timeMultiplierGrowth,\n    weightDecay: settings.weightDecay,\n    waveDirectionSeed: settings.waveDirectionSeed,\n    phaseOffset: settings.phaseOffset,\n    displacementOctaves: settings.displacementOctaves\n  };\n}\n\nexport function cloneDefaultSettings(): OceanSettings {\n  return { ...DEFAULT_OCEAN_SETTINGS };\n}\n","import type { WaveSamplingParams } from \"./types\";\n\nconst OCTAVE_DIRECTION_STEP = 1232.399963;\n\ninterface WaveDxResult {\n  wave: number;\n  derivative: number;\n}\n\nfunction waveDx(\n  posX: number,\n  posZ: number,\n  dirX: number,\n  dirZ: number,\n  frequency: number,\n  timeShift: number\n): WaveDxResult {\n  const x = (dirX * posX + dirZ * posZ) * frequency + timeShift;\n  const wave = Math.exp(Math.sin(x) - 1.0);\n  const derivative = -wave * Math.cos(x);\n  return { wave, derivative };\n}\n\nexport function sampleWaveValue(\n  x: number,\n  z: number,\n  timeSec: number,\n  params: WaveSamplingParams,\n  octaves = params.displacementOctaves\n): number {\n  const totalOctaves = Math.max(0, Math.floor(octaves));\n  if (totalOctaves === 0) {\n    return params.waveMean;\n  }\n\n  let iter = 0.0;\n  let frequency = params.baseFrequency;\n  let timeMultiplier = params.baseTimeMultiplier;\n  let weight = 1.0;\n  let sumValues = 0.0;\n  let sumWeights = 0.0;\n  let sampleX = x;\n  let sampleZ = z;\n\n  for (let i = 0; i < totalOctaves; i += 1) {\n    const directionX = Math.sin(iter + params.waveDirectionSeed);\n    const directionZ = Math.cos(iter + params.waveDirectionSeed);\n    const { wave, derivative } = waveDx(\n      sampleX,\n      sampleZ,\n      directionX,\n      directionZ,\n      frequency,\n      timeSec * timeMultiplier + params.phaseOffset\n    );\n\n    sampleX += directionX * derivative * weight * params.dragMultiplier;\n    sampleZ += directionZ * derivative * weight * params.dragMultiplier;\n\n    sumValues += wave * weight;\n    sumWeights += weight;\n\n    weight *= params.weightDecay;\n    frequency *= params.frequencyMultiplier;\n    timeMultiplier *= params.timeMultiplierGrowth;\n    iter += OCTAVE_DIRECTION_STEP;\n  }\n\n  return sumWeights > 0 ? sumValues / sumWeights : 0.0;\n}\n\n/**\n * SERVER_BUOYANCY_API: deterministic, headless wave height sampler for server physics.\n *\n * This function is intentionally pure math and has no rendering dependency.\n * Given world-space (x, z), simulation time, and shared wave params, it returns\n * a world-space water height that can be used for buoyancy, swimming, and auth logic.\n */\nexport function sampleWaveHeight(\n  x: number,\n  z: number,\n  timeSec: number,\n  params: WaveSamplingParams,\n  octaves = params.displacementOctaves\n): number {\n  const raw = sampleWaveValue(x, z, timeSec, params, octaves);\n  return params.seaLevel + (raw - params.waveMean) * params.waveAmplitude;\n}\n\nexport function sampleWaveNormal(\n  x: number,\n  z: number,\n  timeSec: number,\n  params: WaveSamplingParams,\n  epsilon = 0.1,\n  octaves = params.displacementOctaves\n): [number, number, number] {\n  const h = sampleWaveHeight(x, z, timeSec, params, octaves);\n  const hx = sampleWaveHeight(x + epsilon, z, timeSec, params, octaves);\n  const hz = sampleWaveHeight(x, z + epsilon, timeSec, params, octaves);\n\n  const dx: [number, number, number] = [epsilon, hx - h, 0.0];\n  const dz: [number, number, number] = [0.0, hz - h, epsilon];\n\n  const nx = dz[1] * dx[2] - dz[2] * dx[1];\n  const ny = dz[2] * dx[0] - dz[0] * dx[2];\n  const nz = dz[0] * dx[1] - dz[1] * dx[0];\n  const length = Math.hypot(nx, ny, nz) || 1.0;\n  return [nx / length, ny / length, nz / length];\n}\n","import {\n  BufferGeometry,\n  Camera,\n  Color,\n  Group,\n  LineBasicMaterial,\n  LineLoop,\n  MathUtils,\n  Mesh,\n  ShaderMaterial,\n  Vector3\n} from \"three\";\nimport { buildRingSpecs, createRingGeometry } from \"./oceanGeometry\";\nimport { createOceanMaterial } from \"./oceanShader\";\nimport { toWaveSamplingParams, type OceanSettings, type RingSpec } from \"./types\";\nimport { sampleWaveHeight } from \"./waveMath\";\n\ninterface RingRuntime {\n  spec: RingSpec;\n  mesh: Mesh<BufferGeometry, ShaderMaterial>;\n  helper: LineLoop<BufferGeometry, LineBasicMaterial>;\n}\n\nexport class OceanSystem {\n  public readonly group = new Group();\n  private readonly ringDebugGroup = new Group();\n  private readonly shallowColor = new Color();\n  private readonly deepColor = new Color();\n  private readonly foamColor = new Color();\n  private readonly skyHorizonColor = new Color();\n  private readonly skyZenithColor = new Color();\n  private readonly sunDirection = new Vector3();\n  private rings: RingRuntime[] = [];\n  private timeSec = 0.0;\n\n  constructor(private readonly settings: OceanSettings) {\n    this.group.name = \"OceanSystem\";\n    this.ringDebugGroup.name = \"OceanLODHelpers\";\n    this.group.add(this.ringDebugGroup);\n    this.rebuildGeometry();\n  }\n\n  setTime(timeSec: number): void {\n    this.timeSec = timeSec;\n  }\n\n  getTime(): number {\n    return this.timeSec;\n  }\n\n  getSunDirection(target = new Vector3()): Vector3 {\n    return target.copy(this.sunDirection);\n  }\n\n  getMaxOceanRadius(): number {\n    if (this.rings.length === 0) {\n      return 0;\n    }\n    return this.rings[this.rings.length - 1].spec.outerRadius;\n  }\n\n  getCenterXZ(): { x: number; z: number } {\n    return { x: this.group.position.x, z: this.group.position.z };\n  }\n\n  getRingSummary(): Array<{ innerRadius: number; outerRadius: number; detailScale: number }> {\n    return this.rings.map((ring) => ({\n      innerRadius: ring.spec.innerRadius,\n      outerRadius: ring.spec.outerRadius,\n      detailScale: ring.spec.detailScale\n    }));\n  }\n\n  sampleHeight(x: number, z: number, timeSec = this.timeSec): number {\n    return sampleWaveHeight(x, z, timeSec, toWaveSamplingParams(this.settings));\n  }\n\n  rebuildGeometry(): void {\n    this.disposeRings();\n\n    const ringSpecs = buildRingSpecs(this.settings);\n    for (const spec of ringSpecs) {\n      const geometry = createRingGeometry(spec);\n      const material = createOceanMaterial(spec.detailScale);\n      const mesh = new Mesh(geometry, material);\n      mesh.frustumCulled = false;\n      mesh.name = `OceanRing_${spec.index}`;\n      mesh.renderOrder = 10 + spec.index;\n      this.group.add(mesh);\n\n      const helper = this.createRingHelper(spec);\n      this.ringDebugGroup.add(helper);\n\n      this.rings.push({ spec, mesh, helper });\n    }\n  }\n\n  update(camera: Camera): void {\n    const snap = Math.max(0.001, this.settings.followSnap);\n    const centerX = this.settings.followCameraEveryFrame\n      ? camera.position.x\n      : Math.round(camera.position.x / snap) * snap;\n    const centerZ = this.settings.followCameraEveryFrame\n      ? camera.position.z\n      : Math.round(camera.position.z / snap) * snap;\n    this.group.position.set(centerX, 0.0, centerZ);\n\n    this.updateSunDirection();\n    this.updateUniforms(camera);\n    this.ringDebugGroup.visible = this.settings.debugView === \"rings\";\n  }\n\n  dispose(): void {\n    this.disposeRings();\n  }\n\n  private updateSunDirection(): void {\n    const azimuthDeg =\n      this.settings.sunAzimuthDeg +\n      (this.settings.animateSun ? this.timeSec * this.settings.sunOrbitSpeed * 57.2957795 : 0.0);\n    const azimuth = MathUtils.degToRad(azimuthDeg);\n    const elevation = MathUtils.degToRad(this.settings.sunElevationDeg);\n    const cosElevation = Math.cos(elevation);\n    this.sunDirection\n      .set(\n        Math.cos(azimuth) * cosElevation,\n        Math.sin(elevation),\n        Math.sin(azimuth) * cosElevation\n      )\n      .normalize();\n  }\n\n  private updateUniforms(_camera: Camera): void {\n    const debugMode = this.getDebugModeId();\n    this.shallowColor.set(this.settings.shallowColor);\n    this.deepColor.set(this.settings.deepColor);\n    this.foamColor.set(this.settings.foamColor);\n    this.skyHorizonColor.set(this.settings.skyHorizonColor);\n    this.skyZenithColor.set(this.settings.skyZenithColor);\n\n    for (const ring of this.rings) {\n      const { uniforms } = ring.mesh.material;\n      uniforms.uTime.value = this.timeSec;\n      uniforms.uSeaLevel.value = this.settings.seaLevel;\n      uniforms.uWaveAmplitude.value = this.settings.waveAmplitude;\n      uniforms.uWaveMean.value = this.settings.waveMean;\n      uniforms.uDragMultiplier.value = this.settings.dragMultiplier;\n      uniforms.uBaseFrequency.value = this.settings.baseFrequency;\n      uniforms.uFrequencyMultiplier.value = this.settings.frequencyMultiplier;\n      uniforms.uBaseTimeMultiplier.value = this.settings.baseTimeMultiplier;\n      uniforms.uTimeMultiplierGrowth.value = this.settings.timeMultiplierGrowth;\n      uniforms.uWeightDecay.value = this.settings.weightDecay;\n      uniforms.uWaveDirectionSeed.value = this.settings.waveDirectionSeed;\n      uniforms.uPhaseOffset.value = this.settings.phaseOffset;\n      uniforms.uDisplacementOctaves.value = this.settings.displacementOctaves;\n      uniforms.uNormalOctaves.value = this.settings.normalOctaves;\n      uniforms.uNormalEpsilon.value = this.settings.normalEpsilon;\n      uniforms.uHighFrequencyFadeDistance.value = this.settings.highFrequencyFadeDistance;\n      uniforms.uHighFrequencyFadeStrength.value = this.settings.highFrequencyFadeStrength;\n      uniforms.uFresnelBase.value = this.settings.fresnelBase;\n      uniforms.uFresnelPower.value = this.settings.fresnelPower;\n      uniforms.uReflectionStrength.value = this.settings.reflectionStrength;\n      uniforms.uScatterStrength.value = this.settings.scatterStrength;\n      uniforms.uSkyStrength.value = this.settings.skyStrength;\n      uniforms.uToneMapExposure.value = this.settings.toneMapExposure;\n      uniforms.uShallowColor.value.copy(this.shallowColor);\n      uniforms.uDeepColor.value.copy(this.deepColor);\n      uniforms.uFoamColor.value.copy(this.foamColor);\n      uniforms.uFoamEnabled.value = this.settings.foamEnabled ? 1.0 : 0.0;\n      uniforms.uFoamThreshold.value = this.settings.foamThreshold;\n      uniforms.uFoamIntensity.value = this.settings.foamIntensity;\n      uniforms.uSkyHorizonColor.value.copy(this.skyHorizonColor);\n      uniforms.uSkyZenithColor.value.copy(this.skyZenithColor);\n      uniforms.uSunDirection.value.copy(this.sunDirection);\n      uniforms.uSunIntensity.value = this.settings.sunIntensity;\n      uniforms.uSunGlowPower.value = this.settings.sunGlowPower;\n      uniforms.uSunGlowIntensity.value = this.settings.sunGlowIntensity;\n      uniforms.uFarFadeStart.value = this.settings.farFadeStart;\n      uniforms.uFarFadeEnd.value = this.settings.farFadeEnd;\n      uniforms.uRingDetailScale.value = ring.spec.detailScale;\n      uniforms.uDebugMode.value = debugMode;\n      ring.mesh.material.wireframe = this.settings.wireframe;\n\n      const helperColor = ring.helper.material.color;\n      helperColor.setHSL(0.58 - ring.spec.detailScale * 0.2, 0.8, 0.56);\n      ring.helper.position.y = this.settings.seaLevel + 0.03;\n    }\n  }\n\n  private createRingHelper(spec: RingSpec): LineLoop<BufferGeometry, LineBasicMaterial> {\n    const helperSegments = Math.max(32, Math.floor(spec.angularSegments / 4));\n    const geometry = new BufferGeometry();\n    geometry.setFromPoints(\n      Array.from({ length: helperSegments }, (_, i) => {\n        const angle = (i / helperSegments) * Math.PI * 2.0;\n        return new Vector3(Math.cos(angle) * spec.outerRadius, 0, Math.sin(angle) * spec.outerRadius);\n      })\n    );\n\n    const material = new LineBasicMaterial({\n      color: \"#7ec6ff\",\n      transparent: true,\n      opacity: 0.62,\n      depthWrite: false\n    });\n\n    const helper = new LineLoop(geometry, material);\n    helper.renderOrder = 1000 + spec.index;\n    helper.frustumCulled = false;\n    return helper;\n  }\n\n  private getDebugModeId(): number {\n    switch (this.settings.debugView) {\n      case \"normals\":\n        return 1;\n      case \"height\":\n        return 2;\n      case \"fresnel\":\n        return 3;\n      case \"rings\":\n        return 4;\n      default:\n        return 0;\n    }\n  }\n\n  private disposeRings(): void {\n    for (const ring of this.rings) {\n      this.group.remove(ring.mesh);\n      this.ringDebugGroup.remove(ring.helper);\n      ring.mesh.geometry.dispose();\n      ring.mesh.material.dispose();\n      ring.helper.geometry.dispose();\n      ring.helper.material.dispose();\n    }\n    this.rings = [];\n  }\n}\n","import type { Camera } from \"three\";\nimport { Vector3 } from \"three\";\nimport { OceanSystem } from \"../ocean/OceanSystem\";\nimport {\n  cloneDefaultSettings,\n  OCEAN_GEOMETRY_KEYS,\n  toWaveSamplingParams,\n  type OceanDebugSettings,\n  type OceanGeometrySettings,\n  type OceanSettings,\n  type OceanShadingSettings,\n  type OceanSunSettings,\n  type OceanWaveSettings,\n  type WaveSamplingParams\n} from \"../ocean/types\";\nimport { sampleWaveHeight } from \"../ocean/waveMath\";\n\nexport type OceanOptions = Partial<OceanSettings>;\n\nexport interface OceanUpdateParams {\n  camera: Camera;\n  timeSec?: number;\n  deltaTimeSec?: number;\n}\n\nconst GEOMETRY_OPTION_KEYS = new Set<keyof OceanSettings>(OCEAN_GEOMETRY_KEYS);\n\nfunction mergeWithDefaults(options?: OceanOptions): OceanSettings {\n  return {\n    ...cloneDefaultSettings(),\n    ...(options ?? {})\n  };\n}\n\nexport class Ocean {\n  public readonly object3d;\n  private readonly settings: OceanSettings;\n  private readonly system: OceanSystem;\n  private timeSec = 0.0;\n\n  constructor(options?: OceanOptions) {\n    this.settings = mergeWithDefaults(options);\n    this.system = new OceanSystem(this.settings);\n    this.object3d = this.system.group;\n    this.system.setTime(this.timeSec);\n  }\n\n  getOptions(): OceanSettings {\n    return { ...this.settings };\n  }\n\n  setOptions(options: OceanOptions): void {\n    this.applyOptions(options);\n  }\n\n  setWaveOptions(options: Partial<OceanWaveSettings>): void {\n    this.applyOptions(options);\n  }\n\n  setShadingOptions(options: Partial<OceanShadingSettings>): void {\n    this.applyOptions(options);\n  }\n\n  setSunOptions(options: Partial<OceanSunSettings>): void {\n    this.applyOptions(options);\n  }\n\n  setGeometryOptions(options: Partial<OceanGeometrySettings>): void {\n    this.applyOptions(options);\n  }\n\n  setDebugOptions(options: Partial<OceanDebugSettings>): void {\n    this.applyOptions(options);\n  }\n\n  update({ camera, deltaTimeSec, timeSec }: OceanUpdateParams): void {\n    if (typeof timeSec === \"number\" && Number.isFinite(timeSec)) {\n      this.timeSec = timeSec;\n    } else if (typeof deltaTimeSec === \"number\" && Number.isFinite(deltaTimeSec)) {\n      this.timeSec += deltaTimeSec;\n    }\n\n    this.system.setTime(this.timeSec);\n    this.system.update(camera);\n  }\n\n  advanceTime(deltaTimeSec: number): number {\n    if (Number.isFinite(deltaTimeSec)) {\n      this.timeSec += deltaTimeSec;\n      this.system.setTime(this.timeSec);\n    }\n    return this.timeSec;\n  }\n\n  setTime(timeSec: number): void {\n    this.timeSec = timeSec;\n    this.system.setTime(timeSec);\n  }\n\n  getTime(): number {\n    return this.timeSec;\n  }\n\n  sampleHeight(x: number, z: number, timeSec = this.timeSec): number {\n    return this.system.sampleHeight(x, z, timeSec);\n  }\n\n  getSunDirection(target = new Vector3()): Vector3 {\n    return this.system.getSunDirection(target);\n  }\n\n  getCenterXZ(): { x: number; z: number } {\n    return this.system.getCenterXZ();\n  }\n\n  getMaxRadius(): number {\n    return this.system.getMaxOceanRadius();\n  }\n\n  getWaveSamplingParams(): WaveSamplingParams {\n    return toWaveSamplingParams(this.settings);\n  }\n\n  sampleHeightHeadless(x: number, z: number, timeSec: number): number {\n    return sampleWaveHeight(x, z, timeSec, this.getWaveSamplingParams());\n  }\n\n  dispose(): void {\n    this.system.dispose();\n  }\n\n  private applyOptions(options: OceanOptions): void {\n    let rebuildGeometry = false;\n    for (const key of Object.keys(options) as Array<keyof OceanSettings>) {\n      const nextValue = options[key];\n      if (typeof nextValue === \"undefined\") {\n        continue;\n      }\n      if (this.settings[key] === nextValue) {\n        continue;\n      }\n      this.settings[key] = nextValue as never;\n      if (GEOMETRY_OPTION_KEYS.has(key)) {\n        rebuildGeometry = true;\n      }\n    }\n\n    if (rebuildGeometry) {\n      this.system.rebuildGeometry();\n    }\n  }\n}\n\nexport function createOcean(options?: OceanOptions): Ocean {\n  return new Ocean(options);\n}\n\nexport function createDefaultOceanOptions(): OceanSettings {\n  return cloneDefaultSettings();\n}\n"]}